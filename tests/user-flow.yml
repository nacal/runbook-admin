desc: User Registration Flow Test
labels:
  - e2e
  - user-flow
vars:
  BASE_URL: ${BASE_URL:-http://localhost:3000}
  USER_EMAIL: test@example.com
steps:
  - desc: Access registration page
    req:
      ${BASE_URL}/register:
        get:
    test: |
      current.res.status == 200
  
  - desc: Submit registration form
    req:
      ${BASE_URL}/api/register:
        post:
          body:
            application/json:
              email: ${USER_EMAIL}
              password: TestPass123!
              confirmPassword: TestPass123!
    test: |
      current.res.status == 201 &&
      current.res.body.success == true
    bind:
      userId: current.res.body.userId
  
  - desc: Verify user creation
    req:
      ${BASE_URL}/api/users/${userId}:
        get:
          headers:
            Authorization: Bearer ${TOKEN}
    test: |
      current.res.status == 200 &&
      current.res.body.email == vars.USER_EMAIL