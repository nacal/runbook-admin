desc: Database Connection Test
labels:
  - database
  - integration
vars:
  DB_HOST: localhost
  DB_PORT: 5432
  DB_NAME: test_db
steps:
  - desc: Initialize database connection
    db:
      dsn: postgres://user:pass@${DB_HOST}:${DB_PORT}/${DB_NAME}
  
  - desc: Check tables exist
    db:
      query: |
        SELECT table_name 
        FROM information_schema.tables 
        WHERE table_schema = 'public'
    test: |
      len(rows) > 0
  
  - desc: Verify data integrity
    db:
      query: SELECT COUNT(*) as count FROM users
    test: |
      rows[0].count >= 0